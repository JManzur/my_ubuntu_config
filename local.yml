---
- hosts: localhost
  connection: local
  become: true
  pre_tasks:
  - name: Update and Upgrade
    apt:
      update_cache: yes
      upgrade: 'yes'

  tasks:
  - name: Install packages
    package:
      name:
        - htop
        - vim
        - curl
        - zsh
        - net-tools

  - name: Check if Oh-My-ZSH exists
    stat:
      path: ~/.oh-my-zsh
    register: stat_result

  - name: Download Oh-My-ZSH installer
    get_url:
      url: https://raw.github.com/ohmyzsh/ohmyzsh/master/tools/install.sh
      dest: /opt/zsh-installer.sh
      mode: '0777'
    when: not stat_result.stat.exists
      
  - name: Execute the zsh-installer.sh
    shell: /opt/zsh-installer.sh
    when: not stat_result.stat.exists

  - name: Remove the zsh-installer.sh
    ansible.builtin.file:
      path: /opt/zsh-installer.sh 
      state: absent
    when: not stat_result.stat.exists

  - name: Change Oh-My-ZSH theme
    ansible.builtin.lineinfile:
      path: ~/.zshrc
      regexp: '^ZSH_THEME='
      line: ZSH_THEME="dst"